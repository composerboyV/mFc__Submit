MFC# 프로그램 개요

이 프로그램은 MFC(Microsoft Foundation Classes)를 사용하여 개발된 원 그리기 응용 프로그램입니다. 사용자가 화면에 3개의 점을 클릭하면, 이 세 점을 지나는 원을 자동으로 계산하고 그려줍니다.

# **요구사항**

- 아래 그림의 순서대로 조작하여 요구사항들을 모두 만족하는 프로그램을 작성합니다.
- 세 번째 클릭 이후에 클릭 지점 3개를 모두 지나가는 정원 1개를 그립니다.
- 클릭 지점 원을 그릴 때의 반지름 크기는 사용자로부터 입력 받습니다.
- 각 클릭 지점 원의 중심 좌표를 UI에 표시합니다.
- 네 번째 클릭부터는 클릭 지점 원을 그리지 않습니다.
- 세 클릭 지점을 지나가는 정원의 내부는 채워지지 않아야 하며, 가장자리 두께는 사용자로부터 입력 받습니다.
- 클릭 지점 3개 중 하나를 클릭하고 드래그 했을 때 정원을 다시 그립니다.
- 이 때, 마우스 커서 좌표가 바뀌는 동안 즉, 마우스 드래그 상태가 끝날 때 까지 정원이 계속해서 이동하며 그려져야 합니다.
- [초기화] 버튼을 누르면 그려졌던 모든 내용들을 삭제하고 처음부터 입력 받을 수 있는 상태가 되어야 합니다.
- 정원이 그려진 상태에서 [랜덤 이동] 버튼을 누르면 3개의 클릭 지점 원 모두를 랜덤한 위치로 이동시킵니다.
- 이 때, 정원 또한 마찬가지로 다시 그려져야 합니다.
- 랜덤한 위치로 이동 및 정원 그리기 동작을 초당 2회, 총 10번 자동으로 반복하되 메인UI가 프리징 상태가 되지 않도록 별도 쓰레드로 구현해야 합니다.
- MFC Dialog 기반 프로젝트로 작성해야 합니다.
- 클릭 지점 원과 정원을 그릴 때 Ellipse류 함수를 사용하면 안됩니다. (안내한 유튜브 영상 참고하여 제작)

## 1. 3점을 지나는 원의 수학적 원리

세 점이 일직선 위에 있지 않다면, 이 세 점을 모두 지나는 유일한 원이 존재합니다. 이는 기하학의 기본 원리로, 원의 중심과 반지름을 계산하는 수식은 다음과 같습니다:

```
원의 중심 (h, k)와 반지름 r은 세 점 (x1,y1), (x2,y2), (x3,y3)로부터:
- 행렬식을 이용한 계산
- 원의 방정식: (x-h)² + (y-k)² = r²
```

## 2. 원의 중심을 구하는 수학적 원리

### 1. 크래머 공식

- 크래머의 공식은 선형 연립방정식의 해를 행렬식을 이용해 구하는 방법입니다.

```jsx
h = -D/2,  k = -E/2

크래머 공식으로:
D = Dₓ/D_main
E = Dᵧ/D_main

->
h = -Dₓ/(2*D_main) = -b/(2*a)
k = -Dᵧ/(2*D_main) = -c/(2*a)
```

### 1-1. **크래머 공식의 장단점**

**장점**:

- 공식이 명확하고 직관적
- 프로그래밍하기 쉬움
- 작은 시스템에서 효율적

**단점**:

- D = 0일 때 사용 불가 (세 점이 일직선)
- 큰 시스템에서는 비효율적
- 수치적 오차가 누적될 수 있음

### 2. 반지름 계산

중심을 구한 후, 세 점 중 아무 점이나 선택하여 중심과의 거리를 계산:

```cpp
double dx = x1 - center.x;
double dy = y1 - center.y;
radius = sqrt(dx * dx + dy * dy);
```

## 3. 프레임 워크 구조

1. 프로그램 계층 구조

CMFCApp(응용프로그램)

└─CMFCDlg(메인 다이얼로그)

└─CDrawDlg(그리기 다이얼로그)

2.주요 흐름

2-1.초기화: CMFCApp → CMFCDlg → CDrawDlg → CImage 버퍼 생성

2-2.마우스 클릭 처리: OnLButtonDown → 점 추가/선택 → 3점 완성 시 원 계산 → 화면 갱신

2-3.드래그 처리: OnMouseMove → 점 위치 업데이트 → 원 재계산 → 실시간 갱신

2-4.랜덤 이동: 별도 스레드 → PostMessage → UI 스레드에서 그리기

## 4. 드래그 처리 흐름

```
마우스 다운 → 점 선택 확인
  ↓
마우스 이동 → 선택된 점 위치 업데이트
  ↓
원 재계산 → 화면 갱신
  ↓
마우스 업 → 드래그 종료
```

## 5. 파일 구조

├── MFC.cpp/h           # 메인 애플리케이션 클래스

├── MFCDlg.cpp/h        # 메인 다이얼로그

├── CDrawDlg.cpp/h      # 그리기 다이얼로그

├── resource.h          # 리소스 ID 정의

├── pch.cpp/h           # 미리 컴파일된 헤더

└── framework.h         # MFC 프레임워크 헤더

## 6. 주요 클래스 구조

### CMFCDlg (메인 다이얼로그)

- 전체 UI 레이아웃 관리
- 사용자 입력 처리 (반지름, 두께 설정)
- CDrawDlg와의 통신 조정

### CDrawDlg (그리기 다이얼로그)

- 실제 그리기 로직 구현
- 마우스 이벤트 처리
- 이미지 버퍼 관리
- 원 계산 및 렌더링

## 7. 메모리 및 성능 최적화

1. 8비트 그레이스케일 사용: 메모리 사용량 감소
2. 더블 버퍼링: 깜빡임 방지
3. Bresenham 알고리즘: 부동소수점 연산 최소화 (정수 연산만으로 원을 그리는 효율적인 알고리즘)
4. 8방향 대칭: 계산량 1/8로 감소 ( 원의 대칭성을 이용해 1/8만 계산후 대칭으로 그림)

## ※참고 사항

- Windows 좌표계는 좌상단이 (0,0)이지만, (화면 전체 값 /2) 을 구해서 중앙 기준 좌표계 사용
- CImage의 pitch는 음수일 수 있으므로 abs() 처리 필요
- 스레드 안전성을 위해 atomic 변수 사용